function [Rmmse,wfeTomo] = getMMSE_CANARY(tel,atm,ngs,wfs,sref)

if ~any([atm.layer.altitude])
    cond = 1e3;
else
    cond = 30;
end


covModel = slopesCovarianceModel(tel,atm,wfs,[sref,ngs]);
covMat = covModel.getCovarianceMatrix(); %in arcsec^2
Rmmse = covModel.getMMMSEreconstructor(covMat,cond); % MMSE reconstructor
Cee  = covModel.getErrorCovarianceMatrix(covMat,Rmmse);
phaseToAngle = atm.wavelength/2/pi/covModel.pitch;
wfeTomo = sqrt(trace(Cee))/phaseToAngle

